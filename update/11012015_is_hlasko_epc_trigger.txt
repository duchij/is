//trigger aby ked uzivatel zada  nove epc a ma uz spraveny vykaz toto sa smaze

CREATE DEFINER=`root`@`localhost` TRIGGER `is_hlasko_epc_ai` AFTER INSERT ON `is_hlasko_epc` FOR EACH ROW
begin
   
	
    set @userId = NEW.user_id;
    set @mesiac = MONTH(NEW.work_start);
    set @rok = YEAR(NEW.work_start);
    
    set @vykaz_pocet = (SELECT count(*) FROM is_vykaz WHERE mesiac = @mesiac AND rok=@rok AND user_id = @userId);
   
    IF (@vykaz_pocet > 0) THEN
		
			DELETE FROM is_vykaz WHERE user_id=@userId AND mesiac=@mesiac AND rok=@rok;
		END IF;
    
    
    end


//uprava tabulky is_new

ALTER TABLE `is_news`
ADD `cielova-skupina` enum('doctors','nurses','all') COLLATE 'ascii_general_ci' NOT NULL DEFAULT 'doctors',
COMMENT='';

ALTER TABLE `is_news`
COMMENT='' ENGINE='InnoDB';

ALTER TABLE `is_news`
CHANGE `user` `user` bigint unsigned NOT NULL AFTER `cela_sprava`,
COMMENT='';

ALTER TABLE `is_news`
ADD INDEX `datum` (`datum`);